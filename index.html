<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#7C77D6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3448/3448609.png">
    
    <title>Kaprao52 - V6.1 </title> <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Varela+Round&family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            purple: '#7C77D6', 
                            yellow: '#FFD755', 
                            bg: '#F5F7FB',      
                            text: '#2D3436',    
                        }
                    },
                    fontFamily: {
                        sans: ['Kanit', 'sans-serif'],
                        round: ['Varela Round', 'sans-serif']
                    },
                    borderRadius: {
                        '4xl': '2.5rem',
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #F5F7FB; color: #2D3436; -webkit-tap-highlight-color: transparent; overscroll-behavior-y: none; }
        .hide-scroll::-webkit-scrollbar { display: none; }
        .hide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
        
        .fade-in-up { animation: fadeInUp 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        .price-pop { animation: pricePop 0.3s ease-out; }
        @keyframes pricePop { 50% { transform: scale(1.2); } }

        .category-pill-active {
            background-color: #FFD755;
            color: #2D3436;
            font-weight: 600;
            box-shadow: 0 4px 6px -1px rgba(255, 215, 85, 0.3);
            border: 2px solid #FFD755;
        }
        
        .category-pill-inactive {
            background-color: #FFFFFF;
            color: #9CA3AF;
            border: 2px solid #F3F4F6;
        }

        .menu-card-style {
            background-color: #FFFFFF;
            border-radius: 1.5rem;
            transition: all 0.2s ease;
        }
        
        .menu-card-style:active {
            transform: scale(0.98);
        }

        .nav-btn {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(4px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .input-success {
            border-color: #22c55e !important;
            background-color: #f0fdf4 !important;
            color: #15803d !important;
        }

        /* Parallax Background Pattern */
        #parallax-bg {
            background-image: radial-gradient(#7C77D6 1px, transparent 1px);
            background-size: 30px 30px;
            opacity: 0.1;
        }

        /* --- CLEAN TITLE STYLES (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏´‡∏°‡πà ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢) --- */
        .grand-title {
            display: flex;
            align-items: baseline;
            font-weight: 900;
            font-size: 2.25rem;
            line-height: 1;
            color: #2D3436; /* ‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏° ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢ */
            letter-spacing: -1px;
        }

        .title-highlight {
            color: #FFD755; /* ‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á‡∏ó‡∏≠‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏•‡∏Ç 52 */
            text-shadow: 1px 1px 0px rgba(0,0,0,0.1); /* ‡πÄ‡∏á‡∏≤‡∏ö‡∏≤‡∏á‡πÜ ‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏°‡∏µ‡∏°‡∏¥‡∏ï‡∏¥ */
            margin-left: 2px;
        }

        /* --- LUCKY WHEEL STYLES --- */
        #wheel-container {
            position: relative;
            width: 280px;
            height: 280px;
            margin: 0 auto 20px auto;
            filter: drop-shadow(0 10px 15px rgba(0,0,0,0.1));
        }
        #wheel-canvas {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            transition: transform 8s cubic-bezier(0.1, 0.99, 0.1, 0.99); /* ‡∏´‡∏°‡∏∏‡∏ô 8 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ */
        }
        .wheel-pointer {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0; 
            height: 0; 
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 35px solid #FFD755; /* ‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á Brand */
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.2));
            z-index: 20;
        }
        .wheel-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 50%;
            z-index: 10;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
    </style>
</head>
<body class="pb-32 font-sans select-none relative overflow-x-hidden">

    <div id="parallax-bg" class="fixed top-0 left-0 w-full h-[120vh] z-[-1] pointer-events-none transition-transform duration-75 ease-out"></div>

    <div id="welcome-modal" class="fixed inset-0 z-[100] bg-gray-900/80 backdrop-blur-sm flex items-center justify-center p-6 fade-in-up">
        <div class="bg-white rounded-[2rem] p-8 max-w-sm w-full text-center shadow-2xl relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-2 bg-brand-yellow"></div>
            <div class="w-20 h-20 bg-brand-purple/10 rounded-full flex items-center justify-center mx-auto mb-4 text-4xl">
                üëã
            </div>
            <h2 class="text-2xl font-extrabold text-gray-800 mb-2">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö</h2>
            <p class="text-gray-500 mb-8 leading-relaxed">
                ‡∏Ç‡πâ‡∏≤‡∏ß‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤‡∏ó‡∏≥‡∏™‡∏î‡∏ó‡∏∏‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå<br>
                <span class="text-brand-purple font-medium">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</span>
            </p>
            <button onclick="closeWelcome()" class="w-full bg-brand-purple text-white font-bold py-4 rounded-xl shadow-lg shadow-indigo-200 active:scale-95 transition-transform text-lg">
                ‡∏™‡∏±‡πà‡∏á‡πÄ‡∏•‡∏¢! üçõ
            </button>
        </div>
    </div>

    <div class="px-6 pt-8 pb-4 bg-transparent">
        <div class="flex items-start justify-between">
            <div class="flex items-start gap-3">
                <div class="w-12 h-12 rounded-full bg-yellow-100 overflow-hidden border-2 border-white shadow-sm flex-shrink-0 flex items-center justify-center p-2">
                     <img src="https://cdn-icons-png.flaticon.com/512/3170/3170733.png" alt="Rice Icon" class="w-full h-full object-contain opacity-80">
                </div>
                <div class="flex flex-col justify-center">
                    <p class="text-xs text-gray-400 font-medium mb-1">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏Ñ‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏© ‚ú®</p>
                    
                    <h1 class="grand-title leading-none tracking-tight mb-2 relative z-10 pt-1">
                        KAPRAO<span class="title-highlight">52</span>
                    </h1>

                </div>
            </div>
            
            <button id="pwa-install-btn" onclick="installApp()" class="hidden bg-gray-900 text-white rounded-full px-4 py-2 text-xs font-bold shadow-lg active:scale-95 transition-all flex items-center gap-2">
                <i class="fas fa-download"></i>
                <span>App</span>
            </button>
        </div>
        <p class="text-[11px] text-gray-500 font-light mt-1 ml-[3.75rem]">‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏≠‡∏ö‡∏Å‡∏¥‡∏ô‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤ ‡πÄ‡∏£‡∏≤‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏Å‡∏±‡∏ô ‚ù§Ô∏è</p>
    </div>

    <div class="max-w-md mx-auto px-5">
        
        <div id="hero-banner" onclick="randomMenu()" class="w-full bg-gradient-to-r from-[#7C77D6] to-[#8B86E6] rounded-[1.5rem] p-3 pr-4 relative overflow-hidden shadow-lg shadow-indigo-100 mb-6 fade-in-up mt-2 flex items-center justify-between group cursor-pointer active:scale-98 transition-all duration-200">
            <div class="absolute -right-6 -bottom-6 w-24 h-24 bg-white opacity-10 rounded-full blur-xl group-hover:scale-150 transition-transform duration-500"></div>
            <div class="absolute -left-4 -top-4 w-20 h-20 bg-brand-yellow opacity-10 rounded-full blur-lg"></div>
            
            <div class="relative z-10 flex items-center gap-3">
                <div class="w-10 h-10 bg-white/20 backdrop-blur-md rounded-full flex items-center justify-center text-xl shadow-inner border border-white/10">
                    üé≤
                </div>
                <div class="flex flex-col justify-center">
                    <h3 class="text-sm font-bold text-white leading-tight">‡∏™‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏•‡∏¢‡∏°‡∏±‡πâ‡∏¢?</h3>
                    <p class="text-indigo-100 text-[10px] opacity-90 font-light">‡∏Ñ‡∏¥‡∏î‡πÑ‡∏°‡πà‡∏≠‡∏≠‡∏Å‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏´‡πâ</p>
                </div>
            </div>

            <div class="relative z-10">
                <div class="bg-brand-yellow text-gray-900 px-3 py-1.5 rounded-full text-xs font-bold shadow-md flex items-center gap-2 group-hover:bg-white group-hover:text-brand-purple transition-colors">
                    <span>‡∏Å‡∏î‡πÄ‡∏•‡∏¢</span>
                    <i id="dice-icon" class="fas fa-play text-[10px]"></i>
                </div>
            </div>
        </div>
        <div class="mb-3 flex items-center justify-between">
            <h3 class="font-bold text-gray-800 text-lg">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</h3>
            <div class="flex gap-2">
                <button onclick="scrollTabs(-100)" class="nav-btn w-8 h-8 rounded-full flex items-center justify-center text-gray-500 hover:text-brand-purple active:scale-90 transition-all"><i class="fas fa-chevron-left text-xs"></i></button>
                <button onclick="scrollTabs(100)" class="nav-btn w-8 h-8 rounded-full flex items-center justify-center text-gray-500 hover:text-brand-purple active:scale-90 transition-all"><i class="fas fa-chevron-right text-xs"></i></button>
            </div>
        </div>
        
        <div id="tabs-container" class="sticky top-0 z-30 bg-[#F5F7FB] pt-2 pb-4 -mx-5 px-5 flex gap-3 snap-x scroll-smooth overflow-x-auto hide-scroll transition-all">
            <button onclick="switchCategory('kaprao')" id="tab-kaprao" class="snap-start category-pill-active min-w-[100px] py-3 rounded-full flex flex-col items-center justify-center gap-1 transition-all">
                <span class="text-xl">üå∂Ô∏è</span>
                <span class="text-xs">‡πÄ‡∏°‡∏ô‡∏π‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤</span>
            </button>
            <button onclick="switchCategory('garlic')" id="tab-garlic" class="snap-start category-pill-inactive min-w-[100px] py-3 rounded-full flex flex-col items-center justify-center gap-1 transition-all">
                <span class="text-xl">üßÑ</span>
                <span class="text-xs">‡πÄ‡∏°‡∏ô‡∏π‡∏Å‡∏£‡∏∞‡πÄ‡∏ó‡∏µ‡∏¢‡∏°</span>
            </button>
            <button onclick="switchCategory('noodle')" id="tab-noodle" class="snap-start category-pill-inactive min-w-[100px] py-3 rounded-full flex flex-col items-center justify-center gap-1 transition-all">
                <span class="text-xl">üçú</span>
                <span class="text-xs">‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏™‡πâ‡∏ô</span>
            </button>
            <button onclick="switchCategory('others')" id="tab-others" class="snap-start category-pill-inactive min-w-[100px] py-3 rounded-full flex flex-col items-center justify-center gap-1 transition-all">
                <span class="text-xl">üç≥</span>
                <span class="text-xs">‡πÄ‡∏°‡∏ô‡∏π‡πÑ‡∏Ç‡πà/‡∏≠‡∏∑‡πà‡∏ô‡πÜ</span>
            </button>
            <button onclick="switchCategory('promotion')" id="tab-promotion" class="snap-start category-pill-inactive min-w-[100px] py-3 rounded-full flex flex-col items-center justify-center gap-1 transition-all border-dashed border-red-300 text-red-500">
                <span class="text-xl">üßß</span>
                <span class="text-xs font-bold">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</span>
            </button>
        </div>

        <div class="mb-4 mt-2">
            <h3 id="section-title" class="font-bold text-gray-800 text-lg">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</h3>
        </div>

        <div id="menu-grid" class="flex flex-col gap-4"></div>

        <div class="text-center mt-12 mb-20 opacity-50">
            <p class="text-[10px] font-bold tracking-widest text-gray-400 uppercase">DEVELOPED BY SORAWIT THUNTHAKIJ V6.1</p>
        </div>

    </div>

    <div id="mini-cart-bar" class="fixed bottom-6 left-5 right-5 z-40 hidden fade-in-up">
        <div onclick="openCheckout()" class="bg-gray-900 text-white p-4 rounded-full shadow-2xl shadow-gray-400/50 flex justify-between items-center cursor-pointer active:scale-95 transition-transform">
            <div class="flex items-center gap-3 pl-2">
                <div class="w-10 h-10 bg-gray-800 rounded-full flex items-center justify-center border border-gray-700 text-brand-yellow font-bold" id="mini-count">0</div>
                <div class="flex flex-col">
                    <span class="text-xs text-gray-400">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</span>
                    <span class="font-bold text-lg leading-none" id="mini-total">0 ‡∏ø</span>
                </div>
            </div>
            <div class="flex items-center gap-2 pr-4 text-brand-yellow font-bold text-sm">
                <span>‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</span>
                <i class="fas fa-chevron-up"></i>
            </div>
        </div>
    </div>

    <div id="checkout-overlay" class="fixed inset-0 bg-gray-900/60 backdrop-blur-sm z-50 hidden transition-opacity opacity-0" onclick="closeCheckout()"></div>
    
    <div id="checkout-sheet" class="fixed bottom-0 left-0 right-0 bg-white rounded-t-[2.5rem] z-50 transform translate-y-full transition-transform duration-300 shadow-2xl max-w-md mx-auto h-[80vh] flex flex-col touch-pan-y">
        
        <div id="checkout-drag-handle" class="w-full flex justify-center pt-4 pb-2 cursor-grab active:cursor-grabbing z-50 bg-white rounded-t-[2.5rem]">
            <div class="w-12 h-1.5 bg-gray-300 rounded-full"></div>
        </div>

        <div class="px-6 pb-4 border-b border-gray-100 flex justify-between items-center">
            <h2 class="text-xl font-bold text-gray-800">‡∏™‡∏£‡∏∏‡∏õ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</h2>
            <button onclick="closeCheckout()" class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-500"><i class="fas fa-times"></i></button>
        </div>
        
        <div id="cart-list-container" class="flex-1 overflow-y-auto px-6 py-4 space-y-3 hide-scroll"></div>
        
        <div class="p-6 bg-gray-50 rounded-t-[2rem] space-y-3">
            <div class="bg-white rounded-xl p-3 flex items-center border border-gray-200 shadow-sm">
                <i class="fas fa-user text-gray-400 mr-3 ml-1"></i>
                <input type="text" id="user-name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á..." class="bg-transparent w-full text-sm outline-none text-gray-700">
            </div>
            
            <div class="bg-white rounded-xl p-2 pl-4 flex items-center border border-gray-200 shadow-sm justify-between transition-colors" id="code-input-container">
                <div class="flex items-center gap-2 w-full">
                    <i class="fas fa-ticket-alt text-gray-400" id="code-icon"></i>
                    <input type="text" id="discount-code" placeholder="‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î" class="bg-transparent w-full text-sm outline-none text-gray-700 uppercase transition-colors">
                </div>
                <button onclick="applyDiscount()" id="btn-apply-code" class="bg-gray-800 hover:bg-gray-700 text-white text-xs px-4 py-2 rounded-lg transition-colors font-bold whitespace-nowrap">‡πÉ‡∏ä‡πâ‡πÇ‡∏Ñ‡πâ‡∏î</button>
            </div>
            <p id="discount-msg" class="text-xs h-4 pl-2 font-medium"></p>

            <div class="flex justify-between items-end mb-2 px-2">
                <span class="text-gray-500 text-sm">‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</span>
                <span id="sheet-grand-total" class="text-2xl font-bold text-brand-purple">0 ‡∏ø</span>
            </div>

            <button onclick="submitOrderToLine()" id="btn-submit-order" class="w-full bg-brand-yellow text-gray-900 font-bold py-4 rounded-xl shadow-lg active:scale-95 transition-transform flex justify-center items-center gap-2">
                <span>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á</span>
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <div id="modal-overlay" class="fixed inset-0 bg-gray-900/40 backdrop-blur-sm z-50 hidden transition-opacity opacity-0" onclick="closeModal()"></div>
    
    <div id="modal-content" class="fixed bottom-0 left-0 right-0 bg-white rounded-t-[2.5rem] z-50 transform translate-y-full transition-transform duration-300 shadow-2xl max-w-md mx-auto h-[85vh] flex flex-col touch-pan-y">
        
        <div id="modal-drag-handle" class="w-full flex justify-center pt-4 pb-2 cursor-grab active:cursor-grabbing z-50 bg-white rounded-t-[2.5rem]">
            <div class="w-12 h-1.5 bg-gray-300 rounded-full"></div>
        </div>

        <button onclick="closeModal()" class="absolute top-4 right-4 z-50 bg-gray-900 text-white w-10 h-10 rounded-full flex items-center justify-center shadow-lg active:scale-90 transition-transform border-2 border-white">
            <i class="fas fa-times text-sm"></i>
        </button>

        <div id="modal-scroll-area" class="flex-1 overflow-y-auto hide-scroll px-6 pb-24 pt-4">
            <div class="flex justify-center mb-6">
                <div class="w-24 h-24 bg-brand-bg rounded-full flex items-center justify-center text-6xl shadow-inner border-4 border-white">
                    <span id="modal-icon">üçú</span>
                </div>
            </div>

            <div class="text-center mb-8">
                <h3 id="modal-title" class="text-2xl font-bold text-gray-800 mb-1 font-round">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π</h3>
                <div class="flex justify-center items-center gap-2">
                    <span id="modal-kcal" class="text-xs bg-orange-100 text-orange-600 px-2 py-0.5 rounded-full font-bold transition-all">0 kcal</span>
                    <span class="text-gray-300">|</span>
                    <span id="modal-price" class="text-xl font-bold text-brand-purple">50</span>
                    <span class="text-sm text-gray-400">‡∏ö‡∏≤‡∏ó</span>
                </div>
            </div>

            <div id="modal-meat-section" class="mb-6 hidden">
                <h4 class="font-bold text-gray-800 mb-3 text-sm">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏™‡∏±‡∏ï‡∏ß‡πå</h4>
                <div class="flex gap-2 overflow-x-auto pb-2 hide-scroll">
                    <label class="cursor-pointer flex-shrink-0"><input type="radio" name="modal-meat" value="‡∏™‡∏±‡∏ô‡∏Ñ‡∏≠" class="peer sr-only"><div class="px-4 py-2 rounded-xl border-2 border-gray-100 bg-white text-sm text-gray-500 peer-checked:border-brand-yellow peer-checked:bg-yellow-50 peer-checked:text-gray-800 transition-all">‡∏™‡∏±‡∏ô‡∏Ñ‡∏≠</div></label>
                    <label class="cursor-pointer flex-shrink-0"><input type="radio" name="modal-meat" value="‡∏´‡∏°‡∏π‡∏™‡∏±‡∏ö" class="peer sr-only"><div class="px-4 py-2 rounded-xl border-2 border-gray-100 bg-white text-sm text-gray-500 peer-checked:border-brand-yellow peer-checked:bg-yellow-50 peer-checked:text-gray-800 transition-all">‡∏´‡∏°‡∏π‡∏™‡∏±‡∏ö</div></label>
                    <label class="cursor-pointer flex-shrink-0"><input type="radio" name="modal-meat" value="‡∏´‡∏°‡∏π‡πÄ‡∏î‡πâ‡∏á" class="peer sr-only"><div class="px-4 py-2 rounded-xl border-2 border-gray-100 bg-white text-sm text-gray-500 peer-checked:border-brand-yellow peer-checked:bg-yellow-50 peer-checked:text-gray-800 transition-all">‡∏´‡∏°‡∏π‡πÄ‡∏î‡πâ‡∏á</div></label>
                </div>
            </div>

            <div class="mb-6">
                <h4 class="font-bold text-gray-800 mb-3 text-sm">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏£‡πà‡∏≠‡∏¢</h4>
                <div class="space-y-3">
                    <label class="flex items-center justify-between p-3 rounded-2xl bg-gray-50 border border-transparent hover:border-yellow-200 cursor-pointer transition-all has-[:checked]:bg-yellow-50 has-[:checked]:border-brand-yellow">
                        <div class="flex items-center gap-3"><span class="text-sm font-medium text-gray-700">üíé ‡∏û‡∏¥‡πÄ‡∏®‡∏©</span></div>
                        <div class="flex items-center gap-3"><span class="text-xs font-bold text-gray-400">+10.-</span><input type="checkbox" id="modal-opt-special" class="accent-brand-yellow w-5 h-5 rounded" value="10"></div>
                    </label>
                    <div class="grid grid-cols-2 gap-3">
                        <label class="flex items-center justify-between p-3 rounded-2xl bg-gray-50 border border-transparent has-[:checked]:bg-yellow-50 has-[:checked]:border-brand-yellow cursor-pointer"><span class="text-sm text-gray-700">üç≥ ‡πÑ‡∏Ç‡πà‡∏Ç‡πâ‡∏ô</span><div class="flex items-center gap-2"><span class="text-xs font-bold text-gray-400">+10.-</span><input type="checkbox" id="modal-opt-kaikhon" class="accent-brand-yellow w-4 h-4" value="10"></div></label>
                        <label class="flex items-center justify-between p-3 rounded-2xl bg-gray-50 border border-transparent has-[:checked]:bg-yellow-50 has-[:checked]:border-brand-yellow cursor-pointer"><span class="text-sm text-gray-700">ü•ö ‡πÑ‡∏Ç‡πà‡∏î‡∏≤‡∏ß</span><div class="flex items-center gap-2"><span class="text-xs font-bold text-gray-400">+10.-</span><input type="checkbox" id="modal-opt-kaidao" class="accent-brand-yellow w-4 h-4" value="10"></div></label>
                        <label class="flex items-center justify-between p-3 rounded-2xl bg-gray-50 border border-transparent has-[:checked]:bg-yellow-50 has-[:checked]:border-brand-yellow cursor-pointer"><span class="text-sm text-gray-700">ü•û ‡πÑ‡∏Ç‡πà‡πÄ‡∏à‡∏µ‡∏¢‡∏ß</span><div class="flex items-center gap-2"><span class="text-xs font-bold text-gray-400">+10.-</span><input type="checkbox" id="modal-opt-kaijiao" class="accent-brand-yellow w-4 h-4" value="10"></div></label>
                        <label class="flex items-center justify-between p-3 rounded-2xl bg-gray-50 border border-transparent has-[:checked]:bg-yellow-50 has-[:checked]:border-brand-yellow cursor-pointer"><span class="text-sm text-gray-700">‚ö´ ‡πÑ‡∏Ç‡πà‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏ß‡∏°‡πâ‡∏≤</span><div class="flex items-center gap-2"><span class="text-xs font-bold text-gray-400">+10.-</span><input type="checkbox" id="modal-opt-kaiyiewma" class="accent-brand-yellow w-4 h-4" value="10"></div></label>
                        <label class="flex items-center justify-between p-3 rounded-2xl bg-gray-50 border border-transparent has-[:checked]:bg-yellow-50 has-[:checked]:border-brand-yellow cursor-pointer"><span class="text-sm text-gray-700">ü•ö ‡πÑ‡∏Ç‡πà‡∏ï‡πâ‡∏°</span><div class="flex items-center gap-2"><span class="text-xs font-bold text-gray-400">+10.-</span><input type="checkbox" id="modal-opt-kaitom" class="accent-brand-yellow w-4 h-4" value="10"></div></label>
                    </div>
                </div>
            </div>
            
            <div class="mb-4">
                <h4 class="font-bold text-gray-800 mb-2 text-sm">Note</h4>
                <textarea id="modal-note" rows="2" class="w-full bg-gray-50 border-none rounded-2xl p-4 text-sm focus:ring-2 focus:ring-brand-purple resize-none" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÑ‡∏°‡πà‡πÄ‡∏ú‡πá‡∏î, ‡∏Ç‡πâ‡∏≤‡∏ß‡∏ô‡πâ‡∏≠‡∏¢..."></textarea>
            </div>
        </div>

        <div class="absolute bottom-0 left-0 right-0 p-5 bg-white border-t border-gray-100 rounded-t-[2rem]">
            <button onclick="addToCart()" class="w-full bg-brand-purple text-white font-bold text-lg py-4 rounded-full shadow-lg shadow-indigo-200 active:scale-95 transition-transform flex justify-center items-center gap-2">
                <span>‡πÉ‡∏™‡πà‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</span>
                <i class="fas fa-plus bg-white/20 rounded-full w-6 h-6 flex items-center justify-center text-xs"></i>
            </button>
        </div>
    </div>

    <div id="toast" class="fixed top-5 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-6 py-3 rounded-full shadow-2xl flex items-center gap-3 transition-all duration-300 opacity-0 -translate-y-10 z-[60] pointer-events-none">
        <i class="fas fa-info-circle text-brand-yellow"></i>
        <span class="font-medium text-sm" id="toast-msg">Notification</span>
    </div>

    <script>
        // --- SOUNDS ---
        const sfxPop = new Audio('https://www.soundjay.com/buttons/sounds/button-3.mp3');
        const sfxOrder = new Audio('https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3');
        sfxPop.volume = 0.5;
        sfxOrder.volume = 0.6;

        function triggerHaptic() {
            if (navigator.vibrate) navigator.vibrate(10); 
        }

        // --- WELCOME POPUP ---
        function closeWelcome() {
            const modal = document.getElementById('welcome-modal');
            modal.style.opacity = '0';
            modal.style.transition = 'opacity 0.5s ease';
            setTimeout(() => modal.classList.add('hidden'), 500);
            triggerHaptic();
        }

        // --- PARALLAX BACKGROUND ---
        window.addEventListener('scroll', () => {
            const scrolled = window.scrollY;
            const bg = document.getElementById('parallax-bg');
            if(bg) {
                // Move background at 30% speed of scroll for depth effect
                bg.style.transform = `translateY(${scrolled * 0.3}px)`;
            }
        });

        // --- PWA INSTALL LOGIC ---
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('SW Registered!', reg))
                    .catch(err => console.log('SW Failed!', err));
            });
        }

        let deferredPrompt;
        const installBtn = document.getElementById('pwa-install-btn');

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installBtn.classList.remove('hidden');
        });

        async function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    console.log('User accepted the install prompt');
                }
                deferredPrompt = null;
                installBtn.classList.add('hidden');
            }
        }

        // DATA
        const menuItems = [
            { id: 2, name: "‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤‡∏´‡∏ô‡πà‡∏≠‡πÑ‡∏°‡πâ", price: 55, icon: "üéç", category: "kaprao", reqMeat: true, kcal: 350 },
            { id: 3, name: "‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤‡∏´‡∏°‡∏π‡∏™‡∏±‡∏ö", price: 50, icon: "üê∑", category: "kaprao", reqMeat: false, kcal: 520 },
            { id: 4, name: "‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤‡∏´‡∏°‡∏π‡πÄ‡∏î‡πâ‡∏á", price: 50, icon: "ü•ì", category: "kaprao", reqMeat: false, kcal: 550 },
            { id: 5, name: "‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤‡∏™‡∏±‡∏ô‡∏Ñ‡∏≠", price: 50, icon: "ü•©", category: "kaprao", reqMeat: false, kcal: 600 },
            { id: 6, name: "‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤‡πÑ‡∏Ç‡πà‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏ß‡∏°‡πâ‡∏≤", price: 60, icon: "‚ö´", category: "kaprao", reqMeat: false, kcal: 650 },
            { id: 10, name: "‡∏°‡∏≤‡∏°‡πà‡∏≤‡∏ú‡∏±‡∏î‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤", price: 50, icon: "üçú", category: "noodle", reqMeat: true, kcal: 450 },
            { id: 1, name: "‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤‡∏ß‡∏∏‡πâ‡∏ô‡πÄ‡∏™‡πâ‡∏ô", price: 55, icon: "üçù", category: "noodle", reqMeat: true, kcal: 400 },
            { id: 7, name: "‡∏´‡∏°‡∏π‡∏™‡∏±‡∏ö‡∏Å‡∏£‡∏∞‡πÄ‡∏ó‡∏µ‡∏¢‡∏°", price: 50, icon: "üßÑ", category: "garlic", reqMeat: false, kcal: 500 },
            { id: 8, name: "‡∏™‡∏±‡∏ô‡∏Ñ‡∏≠‡∏Å‡∏£‡∏∞‡πÄ‡∏ó‡∏µ‡∏¢‡∏°", price: 50, icon: "üçñ", category: "garlic", reqMeat: false, kcal: 580 },
            { id: 9, name: "‡∏´‡∏°‡∏π‡πÄ‡∏î‡πâ‡∏á‡∏Å‡∏£‡∏∞‡πÄ‡∏ó‡∏µ‡∏¢‡∏°", price: 50, icon: "üçò", category: "garlic", reqMeat: false, kcal: 530 },
            { id: 11, name: "‡∏Ç‡πâ‡∏≤‡∏ß‡πÑ‡∏Ç‡πà‡∏Ç‡πâ‡∏ô‡∏û‡∏£‡∏¥‡∏Å‡πÄ‡∏ú‡∏≤", price: 40, icon: "üå∂Ô∏è", category: "others", reqMeat: false, desc: "‡πÑ‡∏Ç‡πà 2 ‡∏ü‡∏≠‡∏á", kcal: 450 },
            { id: 12, name: "‡∏Ç‡πâ‡∏≤‡∏ß‡πÑ‡∏Ç‡πà‡∏Ç‡πâ‡∏ô", price: 40, icon: "üçö", category: "others", reqMeat: false, desc: "‡πÑ‡∏Ç‡πà 2 ‡∏ü‡∏≠‡∏á", kcal: 380 },
            { id: 13, name: "‡∏Ç‡πâ‡∏≤‡∏ß‡πÑ‡∏Ç‡πà‡πÄ‡∏à‡∏µ‡∏¢‡∏ß‡∏û‡∏£‡∏¥‡∏Å‡∏™‡∏î", price: 50, icon: "ü•ò", category: "others", reqMeat: false, kcal: 420 },
            { id: 14, name: "‡∏Ç‡πâ‡∏≤‡∏ß‡πÑ‡∏Ç‡πà‡∏î‡∏≤‡∏ß 3 ‡∏ü‡∏≠‡∏á", price: 50, icon: "üç≥", category: "others", reqMeat: false, kcal: 480 },
            { id: 15, name: "‡∏´‡∏ô‡πà‡∏≠‡πÑ‡∏°‡πâ‡∏ú‡∏±‡∏î‡πÑ‡∏Ç‡πà", price: 50, icon: "üéã", category: "others", reqMeat: true, kcal: 300 },
        ];

        // MANU CODE ONLY
        const promotions = [
            { code: "MANU", title: "‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡πÅ‡∏ü‡∏ô‡πÅ‡∏°‡∏ô‡∏¢‡∏π üî¥", desc: "‡∏™‡∏±‡πà‡∏á‡∏Ñ‡∏£‡∏ö 100.- ‡∏•‡∏î 5 ‡∏ö‡∏≤‡∏ó", minOrder: 100, type: "discount", value: 5, color: "bg-red-600", icon: "‚öΩ" }
        ];

        // --- LUCKY WHEEL LOGIC (RIGGED) ---
        let wheelSpinning = false;
        let wheelRotation = 0;
        
        const wheelSegments = [
            { text: "‡∏•‡∏î 5 ‡∏ö‡∏≤‡∏ó", color: "#FFFFFF", type: "discount_5" },
            { text: "‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•", color: "#F3F4F6", type: "none" },
            { text: "‡∏Å‡∏¥‡∏ô‡∏ü‡∏£‡∏µ 40‡∏ö.", color: "#FFD755", type: "free_40" },
            { text: "‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà", color: "#FFFFFF", type: "none" }, // Index 3: ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏•‡πá‡∏≠‡∏Ñ
            { text: "‡∏ü‡∏£‡∏µ‡πÑ‡∏Ç‡πà‡∏î‡∏≤‡∏ß", color: "#F3F4F6", type: "free_egg" },
            { text: "‡∏•‡∏î 10 ‡∏ö‡∏≤‡∏ó", color: "#FFD755", type: "discount_10" }
        ];

        function drawWheel() {
            const canvas = document.getElementById('wheel-canvas');
            if(!canvas) return;
            const ctx = canvas.getContext('2d');
            const size = canvas.width;
            const center = size / 2;
            const sliceAngle = (2 * Math.PI) / wheelSegments.length;

            wheelSegments.forEach((seg, i) => {
                const startAngle = i * sliceAngle - (Math.PI / 2); 
                const endAngle = startAngle + sliceAngle;

                ctx.beginPath();
                ctx.moveTo(center, center);
                ctx.arc(center, center, center, startAngle, endAngle);
                ctx.fillStyle = seg.color;
                ctx.fill();
                ctx.strokeStyle = "#E5E7EB";
                ctx.lineWidth = 1;
                ctx.stroke();

                ctx.save();
                ctx.translate(center, center);
                ctx.rotate(startAngle + sliceAngle / 2);
                ctx.textAlign = "right";
                ctx.fillStyle = "#2D3436";
                ctx.font = "bold 14px Kanit";
                ctx.fillText(seg.text, center - 20, 5);
                ctx.restore();
            });
        }

        function spinWheel() {
            if (wheelSpinning) return;
            wheelSpinning = true;
            triggerHaptic();
            sfxPop.play();

            const box = document.getElementById('wheel-canvas');
            
            // --- RIGGED LOGIC (‡∏•‡πá‡∏≠‡∏Ñ‡∏ú‡∏•) ---
            const fullSpins = 360 * 8; // ‡∏´‡∏°‡∏∏‡∏ô 8 ‡∏£‡∏≠‡∏ö
            const targetDegree = 150;  // ‡∏≠‡∏á‡∏®‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ "‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà"
            const randomVariance = Math.floor(Math.random() * 40) - 20; 
            const currentRot = wheelRotation;
            const nextRotation = (Math.ceil(currentRot / 360) * 360) + fullSpins + targetDegree + randomVariance;
            
            wheelRotation = nextRotation;
            box.style.transform = `rotate(${wheelRotation}deg)`;

            // ‡∏£‡∏≠ 8 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
            setTimeout(() => {
                wheelSpinning = false;
                calculateWinner(wheelRotation % 360);
            }, 8000); 
        }

        function calculateWinner(finalDegree) {
            const sliceDeg = 360 / wheelSegments.length;
            const normalizedDeg = (360 - finalDegree) % 360; 
            const index = Math.floor(normalizedDeg / sliceDeg);
            const winner = wheelSegments[index];

            handleReward(winner);
        }

        function handleReward(reward) {
            if (reward.type === 'free_40') {
                const freeMenus = menuItems.filter(m => m.price === 40);
                if (freeMenus.length > 0) {
                    const luckyMenu = freeMenus[Math.floor(Math.random() * freeMenus.length)];
                    sfxOrder.play(); 
                    confetti({ particleCount: 200, spread: 100, origin: { y: 0.6 } }); 
                    const prizeItem = { ...luckyMenu, price: 0, name: `üéÅ ‡∏ü‡∏£‡∏µ! ${luckyMenu.name}` };
                    openModal(prizeItem);
                    showToast(`‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢! ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö ${luckyMenu.name} ‡∏ü‡∏£‡∏µ!`);
                }
            } else if (reward.type === 'none') {
                // *** ‡πÄ‡∏Ñ‡∏™‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô 100% ***
                showToast("‡πÄ‡∏Å‡∏∑‡∏≠‡∏ö‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏ä‡∏µ‡∏¢‡∏ß! ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏ó‡∏µ‡∏ô‡∏∞");
            } else if (reward.type === 'free_egg') {
                showToast("‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢! ‡πÅ‡∏Ñ‡∏õ‡∏à‡∏≠‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡πÑ‡∏Ç‡πà‡∏î‡∏≤‡∏ß‡∏ü‡∏£‡∏µ");
            } else {
                showToast(`‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢! ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ ${reward.text}`);
            }
        }

        const addonCalories = {
            'special': 80,     
            'kaikhon': 150,    
            'kaidao': 120,     
            'kaijiao': 200,    
            'kaitom': 75,      
            'kaiyiewma': 100   
        };

        let cart = [];
        let currentItem = null;
        let activeCategory = 'kaprao';
        let discountValue = 0;
        let freeItemName = null;
        const addonIds = ['special', 'kaikhon', 'kaidao', 'kaijiao', 'kaitom', 'kaiyiewma'];

        // --- SWIPE LOGIC ---
        function enableSwipeToClose(el, scrollEl, closeCallback) {
            let startY = 0;
            let currentY = 0;
            let isDragging = false;

            el.addEventListener('touchstart', (e) => {
                if (scrollEl.scrollTop <= 0) {
                    startY = e.touches[0].clientY;
                    isDragging = true;
                    el.style.transition = 'none';
                }
            }, { passive: true });

            el.addEventListener('touchmove', (e) => {
                if (!isDragging) return;
                const diff = e.touches[0].clientY - startY;
                if (diff > 0) {
                    if (scrollEl.scrollTop > 0) return;
                    e.preventDefault();
                    el.style.transform = `translateY(${diff}px)`;
                    currentY = diff;
                }
            }, { passive: false });

            el.addEventListener('touchend', () => {
                if (!isDragging) return;
                isDragging = false;
                el.style.transition = 'transform 0.3s cubic-bezier(0.16, 1, 0.3, 1)';
                if (currentY > 150) {
                    closeCallback();
                } else {
                    el.style.transform = '';
                }
                currentY = 0;
            });
        }

        enableSwipeToClose(document.getElementById('modal-content'), document.getElementById('modal-scroll-area'), closeModal);
        enableSwipeToClose(document.getElementById('checkout-sheet'), document.getElementById('cart-list-container'), closeCheckout);

        // --- CORE FUNCTIONS ---
        function scrollTabs(amount) {
            document.getElementById('tabs-container').scrollBy({ left: amount, behavior: 'smooth' });
        }

        function switchCategory(cat) {
            triggerHaptic();
            activeCategory = cat;
            ['kaprao', 'garlic', 'noodle', 'others', 'promotion'].forEach(c => {
                const btn = document.getElementById(`tab-${c}`);
                if (c === cat) {
                    btn.className = "snap-start category-pill-active min-w-[100px] py-3 rounded-full flex flex-col items-center justify-center gap-1 transition-all transform scale-105";
                } else {
                    btn.className = "snap-start category-pill-inactive min-w-[100px] py-3 rounded-full flex flex-col items-center justify-center gap-1 transition-all";
                    if(c === 'promotion') btn.classList.add('border-dashed', 'border-red-300', 'text-red-400');
                }
            });

            if (cat === 'promotion') {
                document.getElementById('section-title').innerText = "‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á & ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô";
                document.getElementById('hero-banner').classList.add('hidden');
                renderPromotions();
            } else {
                document.getElementById('section-title').innerText = "‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥";
                document.getElementById('hero-banner').classList.remove('hidden');
                renderMenu();
            }
        }

        function renderMenu() {
            const grid = document.getElementById('menu-grid');
            grid.innerHTML = '';
            const filteredItems = menuItems.filter(i => i.category === activeCategory);
            
            filteredItems.forEach((item, index) => {
                const el = document.createElement('div');
                el.style.animationDelay = `${index * 0.05}s`;
                el.className = "menu-card-style p-4 flex items-center justify-between cursor-pointer shadow-sm border border-gray-100 fade-in-up group";
                el.onclick = () => openModal(item);
                el.innerHTML = `
                    <div class="flex items-center gap-4">
                        <div class="w-16 h-16 rounded-2xl bg-indigo-50 text-3xl flex items-center justify-center shadow-inner group-hover:bg-indigo-100 transition-colors">
                            ${item.icon}
                        </div>
                        <div>
                            <h3 class="font-bold text-gray-800 text-base group-hover:text-brand-purple transition-colors">${item.name}</h3>
                            <div class="flex items-center gap-2 mt-1">
                                <span class="text-xs text-gray-400 bg-gray-100 px-2 py-0.5 rounded-md">${item.kcal} kcal</span>
                                ${item.reqMeat ? '<span class="text-[10px] text-orange-400 border border-orange-200 px-1.5 rounded">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏™‡∏±‡∏ï‡∏ß‡πå</span>' : ''}
                            </div>
                        </div>
                    </div>
                    <div class="flex items-center gap-3">
                        <span class="font-bold text-gray-700 text-lg">${item.price}</span>
                        <div class="w-8 h-8 rounded-full bg-brand-yellow text-gray-800 flex items-center justify-center shadow-md">
                            <i class="fas fa-plus text-xs"></i>
                        </div>
                    </div>
                `;
                grid.appendChild(el);
            });
        }

        function renderPromotions() {
            const grid = document.getElementById('menu-grid');
            grid.innerHTML = '';

            // 1. SHOW PROMOTIONS FIRST (‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡πà‡∏≠‡∏ô)
            promotions.forEach((promo, index) => {
                const el = document.createElement('div');
                el.className = "menu-card-style p-0 flex overflow-hidden cursor-pointer shadow-sm border border-gray-100 fade-in-up mb-2";
                el.onclick = () => {
                    navigator.clipboard.writeText(promo.code);
                    showToast(`‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î ${promo.code} ‡πÅ‡∏•‡πâ‡∏ß!`);
                    document.getElementById('discount-code').value = promo.code;
                };
                el.innerHTML = `
                    <div class="w-24 ${promo.color} flex flex-col items-center justify-center text-white p-2">
                        <span class="text-2xl">${promo.icon}</span>
                        <span class="text-[10px] opacity-80 mt-1">TAP</span>
                    </div>
                    <div class="flex-1 p-4 flex flex-col justify-center relative bg-white">
                        <div class="absolute left-0 top-0 bottom-0 border-l-2 border-dashed border-gray-100"></div>
                        <h3 class="font-bold text-gray-800">${promo.title}</h3>
                        <p class="text-xs text-gray-400 mt-0.5">${promo.desc}</p>
                        <div class="mt-2 bg-gray-100 inline-block px-2 py-1 rounded text-xs font-bold text-gray-600 tracking-wider w-max border border-gray-200">${promo.code}</div>
                    </div>
                `;
                grid.appendChild(el);
            });

            // 2. SHOW WHEEL SECOND (‡∏ß‡∏á‡∏•‡πâ‡∏≠‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á)
            const wheelDiv = document.createElement('div');
            wheelDiv.className = "w-full bg-white rounded-[1.5rem] p-6 mt-4 mb-6 shadow-sm border border-gray-100 flex flex-col items-center fade-in-up";
            wheelDiv.innerHTML = `
                <h3 class="font-bold text-gray-800 text-lg mb-1">‡∏ß‡∏á‡∏•‡πâ‡∏≠‡∏•‡∏∏‡πâ‡∏ô‡∏Å‡∏¥‡∏ô‡∏ü‡∏£‡∏µ! üé°</h3>
                <p class="text-xs text-gray-400 mb-4">‡∏•‡∏∏‡πâ‡∏ô‡∏£‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏£‡∏≤‡∏Ñ‡∏≤ 40 ‡∏ö‡∏≤‡∏ó ‡∏ü‡∏£‡∏µ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</p>
                
                <div id="wheel-container">
                    <div class="wheel-pointer"></div>
                    <canvas id="wheel-canvas" width="300" height="300"></canvas>
                    <div class="wheel-center text-2xl">üòã</div>
                </div>

                <button onclick="spinWheel()" class="bg-brand-purple text-white px-8 py-3 rounded-full font-bold shadow-lg shadow-indigo-200 active:scale-95 transition-transform hover:bg-indigo-500">
                    ‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏•‡∏¢!
                </button>
            `;
            grid.appendChild(wheelDiv);

            // ‡∏™‡∏±‡πà‡∏á‡∏ß‡∏≤‡∏î‡∏ß‡∏á‡∏•‡πâ‡∏≠‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
            setTimeout(drawWheel, 100);
        }

        function openModal(item) {
            triggerHaptic();
            currentItem = item;
            document.getElementById('modal-title').innerText = item.name;
            document.getElementById('modal-icon').innerText = item.icon;
            document.getElementById('modal-note').value = '';
            
            document.querySelectorAll('input[name="modal-meat"]').forEach(el => el.checked = false);
            addonIds.forEach(id => document.getElementById(`modal-opt-${id}`).checked = false);
            
            const meatSec = document.getElementById('modal-meat-section');
            if(item.reqMeat) meatSec.classList.remove('hidden'); else meatSec.classList.add('hidden');
            
            updateModalPrice();
            const overlay = document.getElementById('modal-overlay');
            const content = document.getElementById('modal-content');
            content.style.transform = ''; 
            overlay.classList.remove('hidden');
            setTimeout(() => {
                overlay.classList.remove('opacity-0');
                content.classList.remove('translate-y-full');
            }, 10);
        }

        function closeModal() {
            const overlay = document.getElementById('modal-overlay');
            const content = document.getElementById('modal-content');
            overlay.classList.add('opacity-0');
            content.classList.add('translate-y-full');
            setTimeout(() => {
                overlay.classList.add('hidden');
                currentItem = null;
                content.style.transform = '';
            }, 300);
        }

        function updateModalPrice() {
            if (!currentItem) return;
            let total = currentItem.price;
            let totalKcal = currentItem.kcal || 0;

            addonIds.forEach(id => {
                if(document.getElementById(`modal-opt-${id}`).checked) {
                    total += 10;
                    totalKcal += (addonCalories[id] || 0); 
                }
            });

            const priceEl = document.getElementById('modal-price');
            priceEl.innerText = total;
            priceEl.classList.remove('price-pop');
            void priceEl.offsetWidth;
            priceEl.classList.add('price-pop');

            const kcalEl = document.getElementById('modal-kcal');
            kcalEl.innerText = totalKcal + ' kcal';
            kcalEl.classList.add('scale-110');
            setTimeout(() => kcalEl.classList.remove('scale-110'), 200);
        }

        addonIds.forEach(id => document.getElementById(`modal-opt-${id}`).addEventListener('change', updateModalPrice));

        function addToCart() {
            if (!currentItem) return;
            let meat = null;
            if (currentItem.reqMeat) {
                const r = document.querySelector('input[name="modal-meat"]:checked');
                if(!r) return showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏™‡∏±‡∏ï‡∏ß‡πå');
                meat = r.value;
            }
            
            let addons = [];
            let addPrice = 0;
            const names = {special:'‡∏û‡∏¥‡πÄ‡∏®‡∏©', kaikhon:'‡πÑ‡∏Ç‡πà‡∏Ç‡πâ‡∏ô', kaidao:'‡πÑ‡∏Ç‡πà‡∏î‡∏≤‡∏ß', kaijiao:'‡πÑ‡∏Ç‡πà‡πÄ‡∏à‡∏µ‡∏¢‡∏ß', kaitom:'‡πÑ‡∏Ç‡πà‡∏ï‡πâ‡∏°', kaiyiewma:'‡πÑ‡∏Ç‡πà‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏ß‡∏°‡πâ‡∏≤'};
            addonIds.forEach(id => {
                if(document.getElementById(`modal-opt-${id}`).checked) {
                    addons.push(names[id]);
                    addPrice += 10;
                }
            });

            cart.push({
                id: Date.now(),
                name: currentItem.name,
                price: currentItem.price + addPrice,
                meat: meat,
                addons: addons,
                note: document.getElementById('modal-note').value.trim()
            });

            sfxPop.currentTime = 0;
            sfxPop.play();
            triggerHaptic();

            closeModal();
            updateMiniCart();
            showToast('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß!');
        }

        function openCheckout() {
            triggerHaptic();
            renderCheckoutList();
            if(document.getElementById('discount-code').value.trim() !== '' && discountValue > 0) {
               applyDiscount();
            }
            const overlay = document.getElementById('checkout-overlay');
            const sheet = document.getElementById('checkout-sheet');
            sheet.style.transform = '';
            overlay.classList.remove('hidden');
            setTimeout(() => {
                overlay.classList.remove('opacity-0');
                sheet.classList.remove('translate-y-full');
            }, 10);
        }

        function closeCheckout() {
            const overlay = document.getElementById('checkout-overlay');
            const sheet = document.getElementById('checkout-sheet');
            overlay.classList.add('opacity-0');
            sheet.classList.add('translate-y-full');
            setTimeout(() => {
                overlay.classList.add('hidden');
                sheet.style.transform = '';
            }, 300);
        }

        function updateMiniCart() {
            const miniBar = document.getElementById('mini-cart-bar');
            if(cart.length > 0) {
                miniBar.classList.remove('hidden');
                let total = cart.reduce((sum, i) => sum + i.price, 0);
                document.getElementById('mini-count').innerText = cart.length;
                document.getElementById('mini-total').innerText = total + " ‡∏ø";
            } else {
                miniBar.classList.add('hidden');
            }
        }

        function renderCheckoutList() {
            const container = document.getElementById('cart-list-container');
            container.innerHTML = '';
            cart.forEach(item => {
                const el = document.createElement('div');
                el.className = "bg-white p-3 rounded-xl border border-gray-100 flex justify-between items-start";
                let detail = item.meat ? `<span class="text-orange-500 text-xs bg-orange-50 px-1 rounded">${item.meat}</span> ` : '';
                if(item.addons.length) detail += `<span class="text-gray-400 text-xs">+${item.addons.join(',')}</span>`;
                el.innerHTML = `
                    <div>
                        <h4 class="font-bold text-gray-800 text-sm">${item.name}</h4>
                        <div class="mt-1">${detail}</div>
                        ${item.note ? `<div class="text-[10px] text-gray-400 mt-1">Note: ${item.note}</div>` : ''}
                    </div>
                    <div class="flex flex-col items-end gap-2">
                        <span class="font-bold text-gray-700">${item.price}.-</span>
                        <button onclick="removeFromCart(${item.id})" class="text-xs text-red-400 bg-red-50 w-6 h-6 rounded flex items-center justify-center"><i class="fas fa-trash"></i></button>
                    </div>
                `;
                container.appendChild(el);
            });
            updateTotalSummary();
        }

        function removeFromCart(id) {
            cart = cart.filter(i => i.id !== id);
            if(cart.length === 0) removeDiscount();
            else if(discountValue > 0) applyDiscount();
            
            renderCheckoutList();
            updateMiniCart();
            if(cart.length === 0) closeCheckout();
        }

        function applyDiscount() {
            const code = document.getElementById('discount-code').value.trim().toUpperCase();
            const inputContainer = document.getElementById('code-input-container');
            const codeIcon = document.getElementById('code-icon');
            const input = document.getElementById('discount-code');
            const btn = document.getElementById('btn-apply-code');
            
            let total = cart.reduce((sum, i) => sum + i.price, 0);
            const msg = document.getElementById('discount-msg');

            discountValue = 0;
            freeItemName = null;
            inputContainer.className = "bg-white rounded-xl p-2 pl-4 flex items-center border border-gray-200 shadow-sm justify-between transition-colors";
            codeIcon.className = "fas fa-ticket-alt text-gray-400";
            input.classList.remove('text-green-700');
            btn.innerHTML = '‡πÉ‡∏ä‡πâ‡πÇ‡∏Ñ‡πâ‡∏î';
            btn.className = 'bg-gray-800 hover:bg-gray-700 text-white text-xs px-4 py-2 rounded-lg transition-colors font-bold whitespace-nowrap';
            btn.onclick = applyDiscount;

            if(code === "") {
                msg.innerText = "";
                updateTotalSummary();
                return;
            }

            const promo = promotions.find(p => p.code === code);
            if (promo) {
                if (total >= promo.minOrder) {
                    if (promo.type === 'discount') {
                        discountValue = promo.value;
                        msg.innerHTML = `<span class="text-green-600"><i class="fas fa-check-circle"></i> ‡πÉ‡∏ä‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡∏•‡∏î ${promo.value} ‡∏ö‡∏≤‡∏ó</span>`;
                    }
                    
                    inputContainer.className = "input-success rounded-xl p-2 pl-4 flex items-center border shadow-sm justify-between transition-colors";
                    codeIcon.className = "fas fa-check-circle text-green-600";
                    input.classList.add('text-green-700');
                    
                    btn.innerHTML = '<i class="fas fa-times"></i> ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å';
                    btn.className = 'bg-red-500 hover:bg-red-600 text-white text-xs px-4 py-2 rounded-lg transition-colors font-bold whitespace-nowrap';
                    btn.onclick = removeDiscount;

                } else {
                    msg.innerHTML = `<span class="text-red-400">‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏±‡πà‡∏á‡∏Ñ‡∏£‡∏ö ${promo.minOrder} ‡∏ö‡∏≤‡∏ó</span>`;
                }
            } else {
                msg.innerHTML = `<span class="text-red-400">‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ</span>`;
            }
            updateTotalSummary();
        }

        function removeDiscount() {
            discountValue = 0;
            freeItemName = null;
            
            const input = document.getElementById('discount-code');
            input.value = '';
            input.readOnly = false;
            input.classList.remove('text-green-700');
            
            const inputContainer = document.getElementById('code-input-container');
            inputContainer.className = "bg-white rounded-xl p-2 pl-4 flex items-center border border-gray-200 shadow-sm justify-between transition-colors";
            
            const codeIcon = document.getElementById('code-icon');
            codeIcon.className = "fas fa-ticket-alt text-gray-400";
            
            const msg = document.getElementById('discount-msg');
            msg.innerText = "";
            
            const btn = document.getElementById('btn-apply-code');
            btn.innerHTML = '‡πÉ‡∏ä‡πâ‡πÇ‡∏Ñ‡πâ‡∏î';
            btn.className = 'bg-gray-800 hover:bg-gray-700 text-white text-xs px-4 py-2 rounded-lg transition-colors font-bold whitespace-nowrap';
            btn.onclick = applyDiscount;

            updateTotalSummary();
        }

        function updateTotalSummary() {
            let total = cart.reduce((sum, i) => sum + i.price, 0);
            let final = Math.max(0, total - discountValue);
            document.getElementById('sheet-grand-total').innerText = final + " ‡∏ø";
        }

        function submitOrderToLine() {
            const name = document.getElementById('user-name').value.trim();
            if (!name) return showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á');
            
            const btn = document.getElementById('btn-submit-order');
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = `<i class="fas fa-circle-notch fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡πÑ‡∏•‡∏ô‡πå...`;
            btn.classList.add('opacity-75');
            
            sfxOrder.play();
            triggerHaptic();

            // Fire Confetti
            confetti({
                particleCount: 150,
                spread: 70,
                origin: { y: 0.6 },
                colors: ['#FFD755', '#7C77D6', '#FFFFFF']
            });

            let total = cart.reduce((sum, i) => sum + i.price, 0);
            let final = Math.max(0, total - discountValue);

            let msg = `üî• ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏à‡∏≤‡∏Å: ‡∏Ñ‡∏∏‡∏ì ${name}\n========================\n`;
            
            cart.forEach((i) => {
                let detail = `${i.name} ${i.meat ? '('+i.meat+')' : ''}`;
                if(i.addons.length) detail += ` +${i.addons.join('+')}`;
                if(i.note) detail += ` [${i.note}]`;
                
                msg += `1 x ${detail}\n`;
            });

            msg += `========================\n`;
            msg += `üíµ ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: ${total} ‡∏ö‡∏≤‡∏ó\n`;
            if(discountValue > 0) msg += `üè∑Ô∏è ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î: -${discountValue} ‡∏ö‡∏≤‡∏ó\n`;
            msg += `üí∞ ‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥: ${final} ‡∏ö‡∏≤‡∏ó\n`;
            msg += `========================\n`;
            msg += `‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏≠‡∏∏‡∏î‡∏´‡∏ô‡∏∏‡∏ô‡∏£‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡πá‡∏Å‡πÜ ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö`;

            setTimeout(() => {
                window.location.href = `https://line.me/R/msg/text/?${encodeURIComponent(msg)}`;
                
                setTimeout(() => {
                    btn.disabled = false;
                    btn.innerHTML = originalText;
                    btn.classList.remove('opacity-75');
                }, 1000);
            }, 800);
        }

        function randomMenu() {
            triggerHaptic();
            const dice = document.getElementById('dice-icon');
            dice.classList.add('fa-spin');
            setTimeout(() => {
                dice.classList.remove('fa-spin');
                const item = menuItems[Math.floor(Math.random() * menuItems.length)];
                if(item.category) switchCategory(item.category);
                openModal(item);
            }, 500);
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = msg;
            t.classList.remove('opacity-0', '-translate-y-10');
            setTimeout(() => t.classList.add('opacity-0', '-translate-y-10'), 2000);
        }

        renderMenu();
    </script>
</body>
</html>
