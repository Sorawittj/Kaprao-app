<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kaprao52-App (Discount)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#F43F5E',
                        secondary: '#F97316',
                    },
                    fontFamily: {
                        sans: ['Kanit', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #FFF1F2; -webkit-tap-highlight-color: transparent; }
        .hide-scroll::-webkit-scrollbar { display: none; }
        .hide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
        
        .fade-enter { animation: fadeEnter 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes fadeEnter { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .modal-up { animation: modalUp 0.4s cubic-bezier(0.33, 1, 0.68, 1); }
        @keyframes modalUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

        .price-bump { animation: priceBump 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes priceBump { 0% { transform: scale(1); } 50% { transform: scale(1.15); color: #F43F5E; } 100% { transform: scale(1); } }

        .glass-nav {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(255,255,255,0.3);
        }

        .tab-active {
            background: linear-gradient(135deg, #F43F5E 0%, #F97316 100%);
            color: white;
            box-shadow: 0 4px 15px -3px rgba(244, 63, 94, 0.4);
            transform: translateY(-1px);
        }
        .tab-inactive {
            background: white;
            color: #64748B;
            border: 1px solid #E2E8F0;
        }
    </style>
</head>
<body class="text-slate-700 pb-32">

    <!-- HEADER -->
    <header class="relative bg-gradient-to-br from-rose-600 via-rose-500 to-orange-500 text-white pt-10 pb-12 px-6 rounded-b-[2.5rem] shadow-2xl shadow-rose-500/20 z-0 overflow-hidden">
        <div class="absolute inset-0 opacity-10 bg-[url('https://www.transparenttextures.com/patterns/food.png')]"></div>
        <div class="absolute -top-10 -right-10 w-40 h-40 bg-white/10 rounded-full blur-3xl"></div>
        
        <div class="relative z-10 flex justify-between items-center max-w-lg mx-auto">
            <div>
                <h1 class="text-4xl font-extrabold tracking-tight drop-shadow-md flex items-center gap-3">
                    ‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤52 <span class="text-3xl filter drop-shadow-lg transform -translate-y-1">üçö</span>
                </h1>
                <p class="text-rose-50 text-base mt-2 font-medium tracking-wide">
                    ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏≠‡∏ö‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤ ‡πÄ‡∏£‡∏≤‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏Å‡∏±‡∏ô
                </p>
            </div>
            <div class="bg-white/20 p-3.5 rounded-2xl backdrop-blur-md shadow-inner border border-white/10">
                <i class="fas fa-fire-burner text-2xl text-white"></i>
            </div>
        </div>
    </header>

    <!-- STICKY CATEGORY TABS -->
    <div class="sticky top-0 z-40 glass-nav pt-4 pb-4 shadow-sm">
        <div class="max-w-lg mx-auto overflow-x-auto hide-scroll px-5">
            <div class="flex space-x-3 min-w-max">
                <button onclick="switchCategory('kaprao')" id="tab-kaprao" class="tab-active px-5 py-2.5 rounded-full text-sm font-medium transition-all duration-300 flex items-center gap-2">
                    <span>üå∂Ô∏è</span> ‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤
                </button>
                <button onclick="switchCategory('garlic')" id="tab-garlic" class="tab-inactive px-5 py-2.5 rounded-full text-sm font-medium transition-all duration-300 flex items-center gap-2">
                    <span>üßÑ</span> ‡∏Å‡∏£‡∏∞‡πÄ‡∏ó‡∏µ‡∏¢‡∏°
                </button>
                <button onclick="switchCategory('noodle')" id="tab-noodle" class="tab-inactive px-5 py-2.5 rounded-full text-sm font-medium transition-all duration-300 flex items-center gap-2">
                    <span>üçú</span> ‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏™‡πâ‡∏ô
                </button>
                <button onclick="switchCategory('others')" id="tab-others" class="tab-inactive px-5 py-2.5 rounded-full text-sm font-medium transition-all duration-300 flex items-center gap-2">
                    <span>üç≥</span> ‡πÑ‡∏Ç‡πà/‡∏≠‡∏∑‡πà‡∏ô‡πÜ
                </button>
            </div>
        </div>
    </div>

    <!-- MAIN CONTENT -->
    <div class="max-w-lg mx-auto px-5 mt-6 relative z-0">
        
        <h2 class="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
            <span class="w-1.5 h-6 bg-rose-500 rounded-full"></span>
            ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
        </h2>

        <!-- Menu Grid -->
        <div id="menu-grid" class="grid grid-cols-1 gap-4 min-h-[300px]"></div>

        <!-- Cart Section -->
        <div id="cart-section" class="hidden mt-10 mb-8 fade-enter">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-bold text-slate-800 flex items-center gap-2">
                    <i class="fas fa-receipt text-rose-500"></i> ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                </h2>
                <span class="bg-rose-100 text-rose-600 text-xs font-bold px-2 py-1 rounded-lg" id="cart-count-badge">0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
            </div>
            
            <div id="cart-items" class="space-y-3"></div>

            <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏£‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î (NEW) -->
            <div class="mt-6 bg-white p-5 rounded-2xl shadow-sm border border-rose-100">
                <label class="block text-slate-700 font-bold mb-2 text-sm flex items-center gap-2">
                    <i class="fas fa-ticket text-orange-500"></i> ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î
                </label>
                <div class="flex gap-2">
                    <input type="text" id="discount-code" class="flex-1 bg-slate-50 border border-slate-200 rounded-xl px-4 py-2.5 outline-none focus:ring-2 focus:ring-orange-400 text-sm uppercase" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î">
                    <button onclick="applyDiscount()" id="btn-apply-code" class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-xl text-sm font-bold transition-colors shadow-md shadow-orange-200">
                        ‡πÉ‡∏ä‡πâ‡πÇ‡∏Ñ‡πâ‡∏î
                    </button>
                </div>
                <p id="discount-msg" class="text-xs mt-2 font-medium hidden"></p>
            </div>

            <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î (Updated) -->
            <div class="mt-4 bg-white p-5 rounded-2xl shadow-sm border border-rose-100 space-y-2">
                <div class="flex justify-between items-center text-sm text-slate-500">
                    <span>‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£</span>
                    <span id="sub-total">0 ‡∏ø</span>
                </div>
                <div class="flex justify-between items-center text-sm text-green-600 font-medium hidden" id="discount-row">
                    <span>‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</span>
                    <span id="discount-val">-0 ‡∏ø</span>
                </div>
                <div class="h-px bg-slate-100 my-2"></div>
                <div class="flex justify-between items-center">
                    <span class="text-slate-800 font-bold">‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</span>
                    <span id="grand-total" class="text-3xl font-bold text-rose-600 tracking-tight">0 ‡∏ø</span>
                </div>
            </div>

            <div class="mt-4 bg-white p-5 rounded-2xl shadow-sm border border-rose-100">
                <label class="block text-slate-700 font-bold mb-2 text-sm">
                    <i class="fas fa-user-circle mr-1 text-rose-500"></i> ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á <span class="text-red-500">*</span>
                </label>
                <input type="text" id="user-name" class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3.5 outline-none focus:ring-2 focus:ring-rose-400 focus:bg-white transition-all text-slate-800 placeholder-slate-400" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏û‡∏µ‡πà‡∏à‡∏≠‡∏¢, ‡∏ô‡πâ‡∏≠‡∏á‡∏ô‡∏ô‡∏ó‡πå">
            </div>
        </div>

        <div class="text-center mt-12 opacity-40 pb-4">
            <p class="text-[10px] font-medium tracking-wide text-slate-400">
                DEVELOPED BY SORAWIT THUNTHAKIJ<br>VERSION 3.3 (DISCOUNT ADDED)
            </p>
        </div>
    </div>

    <!-- FLOATING ACTION BUTTON -->
    <div id="footer-bar" class="fixed bottom-6 left-0 right-0 z-30 transition-transform transform translate-y-[150%] px-5 pointer-events-none">
        <div class="max-w-lg mx-auto pointer-events-auto">
            <button onclick="submitOrderToLine()" class="w-full bg-slate-900 text-white font-bold text-lg py-4 rounded-2xl shadow-xl shadow-slate-900/20 active:scale-[0.98] transition-all flex justify-center items-center gap-3 group">
                <span>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á</span>
                <div class="bg-white/20 rounded-full w-8 h-8 flex items-center justify-center group-hover:bg-white/30 transition-colors">
                    <i class="fas fa-arrow-right text-sm"></i>
                </div>
            </button>
        </div>
    </div>

    <!-- MODAL -->
    <div id="modal-overlay" class="fixed inset-0 bg-slate-900/60 z-50 hidden backdrop-blur-sm transition-opacity opacity-0" onclick="closeModal()"></div>
    
    <div id="modal-content" class="fixed bottom-0 left-0 right-0 bg-white rounded-t-[2rem] z-50 transform translate-y-full transition-transform duration-300 max-h-[90vh] overflow-y-auto hide-scroll shadow-[0_-10px_40px_-15px_rgba(0,0,0,0.3)] max-w-lg mx-auto">
        <!-- Decoration Header -->
        <div class="h-28 bg-rose-50 relative overflow-hidden">
            <div class="absolute -right-6 -top-6 w-32 h-32 bg-rose-200 rounded-full blur-2xl opacity-50"></div>
            <div class="absolute -left-6 -bottom-6 w-32 h-32 bg-orange-200 rounded-full blur-2xl opacity-50"></div>
            <div class="absolute inset-0 flex items-center justify-center pt-4">
                <span id="modal-icon" class="text-7xl drop-shadow-md transform transition-transform hover:scale-110 duration-300">üçõ</span>
            </div>
            <button onclick="closeModal()" class="absolute top-4 right-4 bg-white/60 hover:bg-white rounded-full p-2 w-9 h-9 flex items-center justify-center transition-all shadow-sm backdrop-blur-sm">
                <i class="fas fa-times text-slate-500"></i>
            </button>
        </div>

        <div class="px-6 py-6 pb-10">
            <!-- Header Info -->
            <div class="flex justify-between items-start mb-6">
                <div>
                    <h3 id="modal-title" class="text-2xl font-bold text-slate-800 leading-tight">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π</h3>
                    <p class="text-xs font-medium text-rose-500 mt-1 bg-rose-50 inline-block px-2 py-0.5 rounded">Signature Menu</p>
                </div>
                <div class="flex flex-col items-end">
                    <span id="modal-price" class="text-3xl font-bold text-rose-600">50</span>
                    <span class="text-[10px] text-slate-400">‡∏ö‡∏≤‡∏ó</span>
                </div>
            </div>

            <div class="h-px bg-slate-100 mb-6"></div>

            <div id="modal-meat-section" class="mb-6 hidden">
                <h4 class="font-bold text-slate-700 mb-3 text-sm flex items-center gap-2">
                    <span class="w-1 h-4 bg-rose-500 rounded-full"></span> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏™‡∏±‡∏ï‡∏ß‡πå <span class="text-rose-500">*</span>
                </h4>
                <div class="grid grid-cols-3 gap-2">
                    <label class="cursor-pointer relative group">
                        <input type="radio" name="modal-meat" value="‡∏™‡∏±‡∏ô‡∏Ñ‡∏≠" class="peer sr-only">
                        <div class="py-3 px-2 text-center rounded-xl border border-slate-200 bg-white text-sm font-medium text-slate-600 transition-all peer-checked:border-rose-500 peer-checked:bg-rose-50 peer-checked:text-rose-700 peer-checked:shadow-sm group-hover:border-rose-200">
                            ‡∏™‡∏±‡∏ô‡∏Ñ‡∏≠
                        </div>
                    </label>
                    <label class="cursor-pointer relative group">
                        <input type="radio" name="modal-meat" value="‡∏´‡∏°‡∏π‡∏™‡∏±‡∏ö" class="peer sr-only">
                        <div class="py-3 px-2 text-center rounded-xl border border-slate-200 bg-white text-sm font-medium text-slate-600 transition-all peer-checked:border-rose-500 peer-checked:bg-rose-50 peer-checked:text-rose-700 peer-checked:shadow-sm group-hover:border-rose-200">
                            ‡∏´‡∏°‡∏π‡∏™‡∏±‡∏ö
                        </div>
                    </label>
                    <label class="cursor-pointer relative group">
                        <input type="radio" name="modal-meat" value="‡∏´‡∏°‡∏π‡πÄ‡∏î‡πâ‡∏á" class="peer sr-only">
                        <div class="py-3 px-2 text-center rounded-xl border border-slate-200 bg-white text-sm font-medium text-slate-600 transition-all peer-checked:border-rose-500 peer-checked:bg-rose-50 peer-checked:text-rose-700 peer-checked:shadow-sm group-hover:border-rose-200">
                            ‡∏´‡∏°‡∏π‡πÄ‡∏î‡πâ‡∏á
                        </div>
                    </label>
                </div>
            </div>

            <div class="mb-6">
                <h4 class="font-bold text-slate-700 mb-3 text-sm flex items-center gap-2">
                    <span class="w-1 h-4 bg-orange-500 rounded-full"></span> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏£‡πà‡∏≠‡∏¢
                </h4>
                <div class="space-y-2">
                    <label class="flex items-center justify-between p-3 rounded-xl border border-slate-100 bg-white hover:border-orange-200 cursor-pointer transition-all has-[:checked]:border-orange-500 has-[:checked]:bg-orange-50/50 has-[:checked]:shadow-sm">
                        <div class="flex items-center gap-3">
                            <input type="checkbox" id="modal-opt-special" class="addon-checkbox w-5 h-5 rounded text-orange-500 focus:ring-orange-500 border-gray-300" value="10">
                            <span class="text-sm font-medium text-slate-700">üíé ‡∏û‡∏¥‡πÄ‡∏®‡∏©</span>
                        </div>
                        <span class="text-xs font-bold text-orange-500 bg-orange-50 px-2 py-1 rounded">+10</span>
                    </label>

                    <div class="grid grid-cols-2 gap-2">
                         <label class="flex items-center justify-between p-3 rounded-xl border border-slate-100 bg-white hover:border-orange-200 cursor-pointer transition-all has-[:checked]:border-orange-500 has-[:checked]:bg-orange-50/50">
                            <div class="flex items-center gap-2">
                                <input type="checkbox" id="modal-opt-kaikhon" class="addon-checkbox w-4 h-4 rounded text-orange-500 focus:ring-orange-500 border-gray-300" value="10">
                                <span class="text-sm text-slate-700">üç≥ ‡πÑ‡∏Ç‡πà‡∏Ç‡πâ‡∏ô</span>
                            </div>
                            <span class="text-xs font-bold text-orange-500">+10</span>
                        </label>
                        <label class="flex items-center justify-between p-3 rounded-xl border border-slate-100 bg-white hover:border-orange-200 cursor-pointer transition-all has-[:checked]:border-orange-500 has-[:checked]:bg-orange-50/50">
                            <div class="flex items-center gap-2">
                                <input type="checkbox" id="modal-opt-kaidao" class="addon-checkbox w-4 h-4 rounded text-orange-500 focus:ring-orange-500 border-gray-300" value="10">
                                <span class="text-sm text-slate-700">ü•ö ‡πÑ‡∏Ç‡πà‡∏î‡∏≤‡∏ß</span>
                            </div>
                            <span class="text-xs font-bold text-orange-500">+10</span>
                        </label>
                        <label class="flex items-center justify-between p-3 rounded-xl border border-slate-100 bg-white hover:border-orange-200 cursor-pointer transition-all has-[:checked]:border-orange-500 has-[:checked]:bg-orange-50/50">
                            <div class="flex items-center gap-2">
                                <input type="checkbox" id="modal-opt-kaijiao" class="addon-checkbox w-4 h-4 rounded text-orange-500 focus:ring-orange-500 border-gray-300" value="10">
                                <span class="text-sm text-slate-700">ü•û ‡πÑ‡∏Ç‡πà‡πÄ‡∏à‡∏µ‡∏¢‡∏ß</span>
                            </div>
                            <span class="text-xs font-bold text-orange-500">+10</span>
                        </label>
                        <label class="flex items-center justify-between p-3 rounded-xl border border-slate-100 bg-white hover:border-orange-200 cursor-pointer transition-all has-[:checked]:border-orange-500 has-[:checked]:bg-orange-50/50">
                            <div class="flex items-center gap-2">
                                <input type="checkbox" id="modal-opt-kaitom" class="addon-checkbox w-4 h-4 rounded text-orange-500 focus:ring-orange-500 border-gray-300" value="10">
                                <span class="text-sm text-slate-700">ü•ö ‡πÑ‡∏Ç‡πà‡∏ï‡πâ‡∏°</span>
                            </div>
                            <span class="text-xs font-bold text-orange-500">+10</span>
                        </label>
                    </div>

                    <label class="flex items-center justify-between p-3 rounded-xl border border-slate-100 bg-white hover:border-orange-200 cursor-pointer transition-all has-[:checked]:border-orange-500 has-[:checked]:bg-orange-50/50">
                        <div class="flex items-center gap-3">
                            <input type="checkbox" id="modal-opt-kaiyiewma" class="addon-checkbox w-5 h-5 rounded text-orange-500 focus:ring-orange-500 border-gray-300" value="10">
                            <span class="text-sm font-medium text-slate-700">‚ö´ ‡πÑ‡∏Ç‡πà‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏ß‡∏°‡πâ‡∏≤</span>
                        </div>
                        <span class="text-xs font-bold text-orange-500 bg-orange-50 px-2 py-1 rounded">+10</span>
                    </label>
                </div>
            </div>

            <div class="mb-8">
                <h4 class="font-bold text-slate-700 mb-3 text-sm flex items-center gap-2">
                    <span class="w-1 h-4 bg-slate-400 rounded-full"></span> ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (Note)
                </h4>
                <div class="relative">
                    <input type="text" id="modal-note" class="w-full bg-slate-50 border border-slate-200 rounded-xl pl-10 pr-4 py-3.5 outline-none focus:ring-2 focus:ring-rose-400 focus:bg-white transition-all text-sm" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÑ‡∏°‡πà‡πÄ‡∏ú‡πá‡∏î, ‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà‡πÉ‡∏ö‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤">
                    <i class="fas fa-pen absolute left-3.5 top-1/2 transform -translate-y-1/2 text-slate-400 text-xs"></i>
                </div>
            </div>

            <button onclick="addToCart()" class="w-full bg-gradient-to-r from-rose-500 to-orange-500 text-white font-bold text-lg py-4 rounded-2xl shadow-lg shadow-rose-200 active:scale-[0.98] transition-transform flex justify-center items-center gap-2 relative overflow-hidden group">
                <span class="relative z-10">‡πÉ‡∏™‡πà‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÄ‡∏•‡∏¢</span>
                <i class="fas fa-basket-shopping relative z-10 group-hover:rotate-12 transition-transform"></i>
                <div class="absolute inset-0 bg-white/20 translate-y-full group-hover:translate-y-0 transition-transform duration-300"></div>
            </button>
        </div>
    </div>

    <script>
        // DATA
        const menuItems = [
            // ‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤ (Kaprao)
            { id: 2, name: "‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤‡∏´‡∏ô‡πà‡∏≠‡πÑ‡∏°‡πâ", price: 55, icon: "üéç", category: "kaprao", reqMeat: true },
            { id: 3, name: "‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤‡∏´‡∏°‡∏π‡∏™‡∏±‡∏ö", price: 50, icon: "üê∑", category: "kaprao", reqMeat: false },
            { id: 4, name: "‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤‡∏´‡∏°‡∏π‡πÄ‡∏î‡πâ‡∏á", price: 50, icon: "ü•ì", category: "kaprao", reqMeat: false },
            { id: 5, name: "‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤‡∏™‡∏±‡∏ô‡∏Ñ‡∏≠", price: 50, icon: "ü•©", category: "kaprao", reqMeat: false },
            { id: 6, name: "‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤‡πÑ‡∏Ç‡πà‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏ß‡∏°‡πâ‡∏≤", price: 60, icon: "‚ö´", category: "kaprao", reqMeat: false },
            
            // ‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏™‡πâ‡∏ô (Noodle)
            { id: 10, name: "‡∏°‡∏≤‡∏°‡πà‡∏≤‡∏ú‡∏±‡∏î‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤‡∏´‡∏≠‡∏¢‡∏•‡∏≤‡∏¢", price: 50, icon: "üçú", category: "noodle", reqMeat: true },
            { id: 1, name: "‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤‡∏ß‡∏∏‡πâ‡∏ô‡πÄ‡∏™‡πâ‡∏ô", price: 55, icon: "üçù", category: "noodle", reqMeat: true },

            // ‡∏Å‡∏£‡∏∞‡πÄ‡∏ó‡∏µ‡∏¢‡∏° (Garlic)
            { id: 7, name: "‡∏´‡∏°‡∏π‡∏™‡∏±‡∏ö‡∏Å‡∏£‡∏∞‡πÄ‡∏ó‡∏µ‡∏¢‡∏°", price: 50, icon: "üßÑ", category: "garlic", reqMeat: false },
            { id: 8, name: "‡∏™‡∏±‡∏ô‡∏Ñ‡∏≠‡∏Å‡∏£‡∏∞‡πÄ‡∏ó‡∏µ‡∏¢‡∏°", price: 50, icon: "üçñ", category: "garlic", reqMeat: false },
            { id: 9, name: "‡∏´‡∏°‡∏π‡πÄ‡∏î‡πâ‡∏á‡∏Å‡∏£‡∏∞‡πÄ‡∏ó‡∏µ‡∏¢‡∏°", price: 50, icon: "üçò", category: "garlic", reqMeat: false },

            // ‡∏≠‡∏∑‡πà‡∏ô‡πÜ (Others/Eggs)
            { id: 11, name: "‡∏Ç‡πâ‡∏≤‡∏ß‡πÑ‡∏Ç‡πà‡∏Ç‡πâ‡∏ô‡∏ô‡πâ‡∏≥‡∏û‡∏£‡∏¥‡∏Å‡πÄ‡∏ú‡∏≤", price: 40, icon: "üå∂Ô∏è", category: "others", reqMeat: false, desc: "‡πÑ‡∏Ç‡πà 2 ‡∏ü‡∏≠‡∏á" },
            { id: 12, name: "‡∏Ç‡πâ‡∏≤‡∏ß‡πÑ‡∏Ç‡πà‡∏Ç‡πâ‡∏ô", price: 40, icon: "üçö", category: "others", reqMeat: false, desc: "‡πÑ‡∏Ç‡πà 2 ‡∏ü‡∏≠‡∏á" },
            { id: 13, name: "‡∏Ç‡πâ‡∏≤‡∏ß‡πÑ‡∏Ç‡πà‡πÄ‡∏à‡∏µ‡∏¢‡∏ß‡∏û‡∏£‡∏¥‡∏Å‡∏™‡∏î", price: 50, icon: "ü•ò", category: "others", reqMeat: false },
            { id: 14, name: "‡∏Ç‡πâ‡∏≤‡∏ß‡πÑ‡∏Ç‡πà‡∏î‡∏≤‡∏ß 3 ‡∏ü‡∏≠‡∏á", price: 50, icon: "üç≥", category: "others", reqMeat: false },
            { id: 15, name: "‡∏´‡∏ô‡πà‡∏≠‡πÑ‡∏°‡πâ‡∏ú‡∏±‡∏î‡πÑ‡∏Ç‡πà", price: 50, icon: "üéã", category: "others", reqMeat: true },
        ];

        let cart = [];
        let currentItem = null;
        let activeCategory = 'kaprao';
        // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î
        let discountValue = 0;

        function switchCategory(cat) {
            activeCategory = cat;
            ['kaprao', 'garlic', 'noodle', 'others'].forEach(c => {
                const btn = document.getElementById(`tab-${c}`);
                if(c === cat) {
                    btn.className = "tab-active px-5 py-2.5 rounded-full text-sm font-medium transition-all duration-300 flex items-center gap-2";
                } else {
                    btn.className = "tab-inactive px-5 py-2.5 rounded-full text-sm font-medium transition-all duration-300 flex items-center gap-2 bg-white hover:bg-rose-50";
                }
            });
            renderMenu();
        }

        function renderMenu() {
            const grid = document.getElementById('menu-grid');
            grid.innerHTML = '';
            const filteredItems = menuItems.filter(i => i.category === activeCategory);
            filteredItems.forEach((item, index) => {
                const el = document.createElement('div');
                el.style.animationDelay = `${index * 0.05}s`;
                el.className = "fade-enter bg-white p-4 rounded-2xl shadow-sm border border-slate-100 flex justify-between items-center cursor-pointer active:scale-[0.98] transition-all hover:shadow-md hover:border-rose-200 group";
                el.onclick = () => openModal(item);
                el.innerHTML = `
                    <div class="flex items-center gap-4">
                        <div class="w-14 h-14 bg-gradient-to-br from-rose-50 to-orange-50 text-2xl flex items-center justify-center rounded-2xl shadow-inner group-hover:scale-110 transition-transform duration-300">
                            ${item.icon}
                        </div>
                        <div>
                            <h3 class="font-bold text-slate-800 text-[15px] leading-tight">${item.name}</h3>
                            <p class="text-xs text-slate-400 mt-1">${item.desc || (item.reqMeat ? '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏™‡∏±‡∏ï‡∏ß‡πå' : '‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏≤‡∏ô')}</p>
                        </div>
                    </div>
                    <div class="flex flex-col items-end">
                        <span class="text-rose-600 font-bold bg-rose-50 px-2.5 py-1 rounded-lg text-sm group-hover:bg-rose-600 group-hover:text-white transition-colors">${item.price}.-</span>
                        <div class="mt-1 w-6 h-6 rounded-full bg-slate-50 flex items-center justify-center text-slate-300 group-hover:bg-orange-100 group-hover:text-orange-500 transition-colors">
                            <i class="fas fa-plus text-xs"></i>
                        </div>
                    </div>
                `;
                grid.appendChild(el);
            });
        }

        // --- DISCOUNT LOGIC ---
        function applyDiscount() {
            const codeInput = document.getElementById('discount-code');
            const code = codeInput.value.trim();
            const msg = document.getElementById('discount-msg');
            const btn = document.getElementById('btn-apply-code');

            if (code === '‡πÄ‡∏à‡∏™‡∏∏‡∏î‡∏´‡∏•‡πà‡∏≠DIS5') {
                discountValue = 5;
                msg.innerHTML = '<i class="fas fa-check-circle mr-1"></i> ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏•‡∏î 5 ‡∏ö‡∏≤‡∏ó';
                msg.className = 'text-xs mt-2 font-bold text-green-500 fade-enter';
                msg.classList.remove('hidden');
                
                // Disable input & button style change
                codeInput.disabled = true;
                codeInput.classList.add('bg-gray-100', 'text-gray-500');
                btn.disabled = true;
                btn.classList.add('opacity-50', 'cursor-not-allowed');
                btn.innerText = '‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß';
            } else {
                discountValue = 0;
                msg.innerHTML = '<i class="fas fa-times-circle mr-1"></i> ‡πÇ‡∏Ñ‡πâ‡∏î‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
                msg.className = 'text-xs mt-2 font-bold text-red-500 fade-enter';
                msg.classList.remove('hidden');
            }
            renderCart(); // Re-calculate total
        }

        // --- CART RENDER WITH DISCOUNT ---
        function renderCart() {
            const section = document.getElementById('cart-section');
            const list = document.getElementById('cart-items');
            const footer = document.getElementById('footer-bar');
            
            // Elements for calculation
            const subTotalEl = document.getElementById('sub-total');
            const discountRow = document.getElementById('discount-row');
            const discountValEl = document.getElementById('discount-val');
            const grandTotalEl = document.getElementById('grand-total');

            if (cart.length === 0) {
                section.classList.add('hidden');
                footer.classList.add('translate-y-[150%]');
                return;
            }

            section.classList.remove('hidden');
            footer.classList.remove('translate-y-[150%]');
            list.innerHTML = '';
            
            let subTotal = 0;
            cart.forEach((item, idx) => {
                subTotal += item.total;
                const meatStr = item.meat ? `<span class="text-rose-500">(${item.meat})</span>` : '';
                const addonStr = item.addons.length > 0 ? `<div class="text-[11px] text-slate-400 mt-0.5">+ ${item.addons.join(', ')}</div>` : '';
                const noteStr = item.note ? `<div class="text-[11px] text-orange-500 mt-0.5"><i class="fas fa-comment-dots mr-1"></i>${item.note}</div>` : '';

                const div = document.createElement('div');
                div.className = "bg-white p-4 rounded-xl border border-rose-50 shadow-sm flex justify-between items-start fade-enter relative overflow-hidden";
                div.innerHTML = `
                    <div class="absolute left-0 top-0 bottom-0 w-1 bg-gradient-to-b from-rose-400 to-orange-400"></div>
                    <div class="flex-1 pl-2">
                        <div class="font-bold text-slate-700 text-sm">
                            <span class="text-slate-300 mr-1 font-light">#${idx+1}</span>
                            ${item.menuName} ${meatStr}
                        </div>
                        ${addonStr}
                        ${noteStr}
                    </div>
                    <div class="flex flex-col items-end gap-2">
                        <span class="font-bold text-slate-800">${item.total}.-</span>
                        <button onclick="removeFromCart(${item.id})" class="text-[10px] text-red-400 bg-red-50 hover:bg-red-100 px-2 py-1 rounded transition-colors">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                list.appendChild(div);
            });

            // Calculate Final Price
            const netTotal = Math.max(0, subTotal - discountValue);

            document.getElementById('cart-count-badge').innerText = `${cart.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
            
            // Display Math
            subTotalEl.innerText = `${subTotal} ‡∏ø`;
            if (discountValue > 0) {
                discountRow.classList.remove('hidden');
                discountValEl.innerText = `-${discountValue} ‡∏ø`;
            } else {
                discountRow.classList.add('hidden');
            }
            grandTotalEl.innerText = `${netTotal} ‡∏ø`;
        }

        // --- SUBMIT WITH DISCOUNT ---
        function submitOrderToLine() {
            const name = document.getElementById('user-name').value.trim();
            if(!name) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö');
                document.getElementById('user-name').focus();
                return;
            }

            let msg = `üî• ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏à‡∏≤‡∏Å: ‡∏Ñ‡∏∏‡∏ì ${name}\n========================\n`;
            let subTotal = 0;
            
            cart.forEach((item, i) => {
                subTotal += item.total;
                let detail = item.menuName;
                if(item.meat) detail += ` (${item.meat})`;
                if(item.addons.length) detail += ` + ${item.addons.join('+')}`;
                
                msg += `${i+1}. ${detail}`;
                if(item.note) msg += `\n   (üìù ${item.note})`;
                msg += `\n`;
            });

            const netTotal = Math.max(0, subTotal - discountValue);

            msg += `========================\n`;
            msg += `üíµ ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: ${subTotal} ‡∏ö‡∏≤‡∏ó\n`;
            if(discountValue > 0) {
                msg += `üè∑Ô∏è ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î: -${discountValue} ‡∏ö‡∏≤‡∏ó (Code)\n`;
            }
            msg += `üí∞ ‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥: ${netTotal} ‡∏ö‡∏≤‡∏ó\n`;
            msg += `========================\n`;
            msg += `Developed by Sorawit (v3.3)`;

            window.location.href = `https://line.me/R/msg/text/?${encodeURIComponent(msg)}`;
        }

        // --- Other Functions (Same as before) ---
        const modalOverlay = document.getElementById('modal-overlay');
        const modalContent = document.getElementById('modal-content');
        const addonIds = ['special', 'kaikhon', 'kaidao', 'kaijiao', 'kaitom', 'kaiyiewma'];

        function openModal(item) {
            currentItem = item;
            document.getElementById('modal-title').innerText = item.name;
            document.getElementById('modal-icon').innerText = item.icon;
            document.getElementById('modal-note').value = '';
            document.querySelectorAll('input[name="modal-meat"]').forEach(el => el.checked = false);
            addonIds.forEach(id => document.getElementById(`modal-opt-${id}`).checked = false);
            const meatSec = document.getElementById('modal-meat-section');
            if(item.reqMeat) meatSec.classList.remove('hidden');
            else meatSec.classList.add('hidden');
            updateModalPrice();
            modalOverlay.classList.remove('hidden');
            setTimeout(() => {
                modalOverlay.classList.remove('opacity-0');
                modalContent.classList.remove('translate-y-full');
            }, 10);
        }

        function closeModal() {
            modalOverlay.classList.add('opacity-0');
            modalContent.classList.add('translate-y-full');
            setTimeout(() => {
                modalOverlay.classList.add('hidden');
                currentItem = null;
            }, 300);
        }

        function updateModalPrice() {
            if (!currentItem) return;
            let total = currentItem.price;
            addonIds.forEach(id => {
                if(document.getElementById(`modal-opt-${id}`).checked) total += 10;
            });
            const priceEl = document.getElementById('modal-price');
            priceEl.innerText = total;
            priceEl.classList.remove('price-bump');
            void priceEl.offsetWidth;
            priceEl.classList.add('price-bump');
        }

        addonIds.forEach(id => document.getElementById(`modal-opt-${id}`).addEventListener('change', updateModalPrice));

        function addToCart() {
            if (!currentItem) return;
            let selectedMeat = null;
            if (currentItem.reqMeat) {
                const meatRadio = document.querySelector('input[name="modal-meat"]:checked');
                if (!meatRadio) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö');
                selectedMeat = meatRadio.value;
            }
            let addons = [];
            let addonPrice = 0;
            const checks = [
                {id: 'special', name: '‡∏û‡∏¥‡πÄ‡∏®‡∏©', price: 10},
                {id: 'kaikhon', name: '‡πÑ‡∏Ç‡πà‡∏Ç‡πâ‡∏ô', price: 10},
                {id: 'kaidao', name: '‡πÑ‡∏Ç‡πà‡∏î‡∏≤‡∏ß', price: 10},
                {id: 'kaijiao', name: '‡πÑ‡∏Ç‡πà‡πÄ‡∏à‡∏µ‡∏¢‡∏ß', price: 10},
                {id: 'kaitom', name: '‡πÑ‡∏Ç‡πà‡∏ï‡πâ‡∏°', price: 10},
                {id: 'kaiyiewma', name: '‡πÑ‡∏Ç‡πà‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏ß‡∏°‡πâ‡∏≤', price: 10},
            ];
            checks.forEach(opt => {
                if(document.getElementById(`modal-opt-${opt.id}`).checked) {
                    addons.push(opt.name);
                    addonPrice += opt.price;
                }
            });
            const orderItem = {
                id: Date.now(),
                menuName: currentItem.name,
                basePrice: currentItem.price,
                meat: selectedMeat,
                addons: addons,
                total: currentItem.price + addonPrice,
                note: document.getElementById('modal-note').value.trim()
            };
            cart.push(orderItem);
            renderCart();
            closeModal();
            setTimeout(() => {
                document.getElementById('cart-section').scrollIntoView({ behavior: 'smooth' });
            }, 300);
        }

        function removeFromCart(id) {
            cart = cart.filter(i => i.id !== id);
            renderCart();
        }

        renderMenu(); 
    </script>
</body>
</html>
